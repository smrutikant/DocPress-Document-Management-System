<%- include('../partials/header') %>

<style>
/* Animated SVG Background */
.svg-background {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  opacity: 0.08;
  z-index: 0;
  pointer-events: none;
}

.floating-shape {
  position: absolute;
  animation: float 20s infinite ease-in-out;
}

.shape-1 {
  top: 10%;
  left: 10%;
  animation-delay: 0s;
}

.shape-2 {
  top: 60%;
  left: 70%;
  animation-delay: 5s;
}

.shape-3 {
  top: 30%;
  right: 10%;
  animation-delay: 10s;
}

.shape-4 {
  bottom: 20%;
  left: 30%;
  animation-delay: 15s;
}

@keyframes float {
  0%, 100% {
    transform: translate(0, 0) rotate(0deg);
  }
  25% {
    transform: translate(30px, -30px) rotate(90deg);
  }
  50% {
    transform: translate(-20px, 20px) rotate(180deg);
  }
  75% {
    transform: translate(20px, 30px) rotate(270deg);
  }
}
</style>

<!-- Animated SVG Background -->
<div class="svg-background">
  <svg class="floating-shape shape-1" width="120" height="120" viewBox="0 0 120 120">
    <circle cx="60" cy="60" r="50" fill="var(--accent-color)" opacity="0.6"/>
  </svg>
  <svg class="floating-shape shape-2" width="100" height="100" viewBox="0 0 100 100">
    <rect width="80" height="80" x="10" y="10" fill="#6bb6ff" opacity="0.5" rx="20"/>
  </svg>
  <svg class="floating-shape shape-3" width="90" height="90" viewBox="0 0 90 90">
    <polygon points="45,10 80,70 10,70" fill="var(--accent-color)" opacity="0.4"/>
  </svg>
  <svg class="floating-shape shape-4" width="110" height="110" viewBox="0 0 110 110">
    <ellipse cx="55" cy="55" rx="40" ry="50" fill="#6bb6ff" opacity="0.5"/>
  </svg>
</div>

<div class="user-layout">
  <%- include('../partials/user-sidebar') %>

  <div class="user-content" style="position: relative; z-index: 1;">
    <a href="/browse" style="display: inline-block; margin-bottom: 20px; color: var(--accent-color); text-decoration: none; font-size: 0.95rem;">‚Üê Back to Library</a>

    <div class="subject-layout">
      <div class="subject-book-preview">
        <div class="subject-book-spine">
          <div class="subject-book-spine-title"><%= subject.title %></div>
          <div class="subject-book-spine-author"><%= subject.author.username %></div>
        </div>
        <div class="subject-book-cover">
          <% if (subject.coverImage) { %>
            <div class="subject-cover-image" style="background-image: url('/<%= subject.coverImage %>');"></div>
          <% } else { %>
            <div class="subject-cover-default">
              <div class="subject-book-icon">üìö</div>
            </div>
          <% } %>
          <div class="subject-cover-overlay">
            <h1><%= subject.title %></h1>
            <p class="subject-author">by <%= subject.author.username %></p>
          </div>
        </div>
        <div class="subject-info">
          <p class="subject-description"><%= subject.description || 'No description available.' %></p>
          <% if (subject.topics && subject.topics.length > 0) { %>
            <p class="subject-meta"><strong><%= subject.topics.length %></strong> chapter<%= subject.topics.length !== 1 ? 's' : '' %> in this book</p>
          <% } %>
        </div>
      </div>

      <div class="chapters-section">
        <h2>Table of Contents</h2>
        <% if (subject.topics && subject.topics.length > 0) { %>
          <div class="chapters-list">
            <% subject.topics.forEach((topic, index) => { %>
              <a href="/topic/<%= topic.slug %>" class="chapter-item">
                <div class="chapter-number">
                  <span>Chapter</span>
                  <strong><%= index + 1 %></strong>
                </div>
                <div class="chapter-content">
                  <h3 class="chapter-title"><%= topic.title %></h3>
                  <p class="chapter-description"><%= topic.description || 'No description' %></p>
                </div>
                <div class="chapter-arrow">‚Üí</div>
              </a>
            <% }); %>
          </div>
        <% } else { %>
          <div class="empty-state">
            <p>No chapters available in this book yet.</p>
          </div>
        <% } %>
      </div>
    </div>
  </div>
</div>

<%- include('../partials/footer') %>
